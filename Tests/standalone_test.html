<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standalone Test</title>
    <!-- Include all the same CSS files as the original -->
    <link rel="stylesheet" href="test.css">
    <link rel="stylesheet" href="testing_hub.css">
    <link rel="stylesheet" href="css/englishCase.css">
    <link rel="stylesheet" href="css/soundsCase.css">
    <link rel="stylesheet" href="css/oralCase.css">
    <link rel="stylesheet" href="css/comparisonCase.css">
    <link rel="stylesheet" href="css/coloringCase.css">
    <link rel="stylesheet" href="css/sortingCase.css">
    <link rel="stylesheet" href="css/imagingCase.css">
    <link rel="stylesheet" href="css/numberTableCase.css">
    <link rel="stylesheet" href="css/handwritingCase.css">
    <link rel="stylesheet" href="css/oneWord.css">
    <link rel="stylesheet" href="css/image_basedCase.css">
    <link rel="stylesheet" href="css/time.css">
    
    <!-- Include the same fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Advantage&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700&family=Raleway:wght@400;700&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Share&display=swap">
    
    <style>
        /* Additional styles for the standalone version */
        #submission-container {
            margin: 20px auto;
            padding: 20px;
            max-width: 800px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        #submit-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        #submit-btn:hover {
            background-color: #45a049;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: white;
        }
        
        .correct {
            border-left: 4px solid #4CAF50;
        }
        
        .incorrect {
            border-left: 4px solid #f44336;
        }
        
        .score-display {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            font-weight: bold;
        }
        
        /* Hide unnecessary elements in standalone version */
        #savePDF, #refreshBtn, #printContent, #saveAsStandalone, 
        #show-answer-key-btn, .watermark {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Main test container (same structure as original) -->
    <div style="display: flex; justify-content: space-between; margin: 0 5px;">
        <img src="../images/Flying_Wings_Academy.png" id="logo" alt="home_logo" width="306" height="250">
        <h2 id="Heading">Flying Wings Academy</h2>
    </div>
    <p id="motto">The Way to Success</p>

    <div class="table-container">
        <table>
            <tr>
                <th colspan="5">Performance Report</th>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td style="text-align:right;font-family: 'Dancing Script', cursive;">%</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <th colspan="5" style="height:15px;background-color:transparent;border-radius:0 0 10px 10px;border-top:1px solid rgba(0,0,0,0.4);"></th>
            </tr>
        </table>
    </div>

    <div style="display: flex; justify-content: space-between; margin: 0 5px;">
        <p id="class-name">Class</p>
        <p id="subject">Subject</p>
        <p id="term">Term</p>
        <p id="part">Part</p>
    </div>

    <div style="display: flex; justify-content: space-between; margin: 0 5px;">
        <p class="pupil">Your Full Names: ___________________________ _________________ ___________________________</p>
    </div>

    <img id="classImage" src="" alt="Class Image" />

    <svg id="barcode"></svg>

    <div id="test-container">
        <div class="content-section">
            <!-- Questions will be loaded here -->
        </div>
    </div>
    <div id="teacher-name"></div>

    <!-- Submission container for standalone version -->
    <div id="submission-container">
        <button id="submit-btn">Submit Answers</button>
        <div id="results-display"></div>
    </div>

    <footer class="page-number"></footer>

    <!-- Include the same JS libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    
    <!-- Include all the question type handlers -->
    <script src="./jsCases/multiple_choice.js"></script>
    <script src="./jsCases/special.js"></script>
    <script src="./jsCases/true_false.js"></script>
    <script src="./jsCases/oral.js"></script>
    <script src="./jsCases/sounds.js"></script>
    <script src="./jsCases/fill_in_the_blank.js"></script>
    <script src="./jsCases/one_word.js"></script>
    <script src="./jsCases/math.js"></script>
    <script src="./jsCases/number_comparison.js"></script>
    <script src="./jsCases/matching.js"></script>
    <script src="./jsCases/spellings_unique.js"></script>
    <script src="./jsCases/punctuations_unique.js"></script>
    <script src="./jsCases/wordMeaning_unique.js"></script>
    <script src="./jsCases/sentenceOrdering_unique.js"></script>
    <script src="./jsCases/comprehension.js"></script>
    <script src="./jsCases/image_based.js"></script>
    <script src="./jsCases/imaging.js"></script>
    <script src="./jsCases/maze.js"></script>
    <script src="./jsCases/crossword.js"></script>
    <script src="./jsCases/coloring.js"></script>
    <script src="./jsCases/identification.js"></script>
    <script src="./jsCases/tracing.js"></script>
    <script src="./jsCases/handwriting.js"></script>
    <script src="./jsCases/reading.js"></script>
    <script src="./jsCases/sudoku.js"></script>
    <script src="./jsCases/identity.js"></script>
    <script src="./jsCases/time.js"></script>
    <script src="./jsCases/wordSearchPuzzle.js"></script>
    <script src="./jsCases/objectMath.js"></script>
    <script src="./jsCases/numberLine.js"></script>
    <script src="./jsCases/numberTable.js"></script>

    <script>
        // Load test data from URL parameters
        document.addEventListener('DOMContentLoaded', function() {
            // Get test data from URL
            const urlParams = new URLSearchParams(window.location.search);
            const testData = urlParams.get('data');
            
            if (testData) {
                try {
                    const data = JSON.parse(decodeURIComponent(testData));
                    loadTestData(data);
                    displayQuestions(data.questions);
                } catch (e) {
                    console.error('Error parsing test data:', e);
                    alert('Error loading test data');
                }
            }
            
            // Generate barcode with current URL
            JsBarcode("#barcode", window.location.href, {
                format: "CODE128",
                displayValue: true
            });
        });

        function loadTestData(data) {
            // Load class info
            if (data.className) document.getElementById('class-name').textContent = data.className;
            if (data.subject) document.getElementById('subject').textContent = data.subject;
            if (data.term) document.getElementById('term').textContent = data.term;
            if (data.part) document.getElementById('part').textContent = data.part;
            if (data.classImage) document.getElementById('classImage').src = data.classImage;
            if (data.teacherName) document.getElementById('teacher-name').textContent = data.teacherName;
            
            // Store correct answers in localStorage
            if (data.answers) {
                localStorage.clear();
                Object.keys(data.answers).forEach(key => {
                    localStorage.setItem(`answer-${key}`, data.answers[key]);
                });
            }
        }

        function displayQuestions(questionsData) {
            const testContainer = document.getElementById('test-container');
            testContainer.innerHTML = ''; // Clear previous questions

            // Track added sections to avoid duplicates
            const addedSections = {
                "multiple_choice": false,
                "special": false,    
                "true_false": false,
                "oral": false,
                "sounds": false,
                "fill_in_the_blank": false,
                "matching": false,
                "one_word": false,
                "math": false,
                "number_comparison": false,
                "spellings_unique": false,
                "punctuations_unique": false, 
                "wordMeaning_unique": false,    
                "sentenceOrdering_unique": false,
                "comprehension": false,
                "image_based": false,
                "imaging": false,
                "maze": false,
                "crossword": false,
                "coloring": false,    
                "identification": false,        
                "tracing": false,
                "handwriting": false,
                "reading": false,
                "sudoku": false,
                "identity": false,
                "time": false,
                "wordSearchPuzzle": false,
                "objectMath": false,
                "numberLine": false,
                "numberTable": false    
            };

            let sectionIdentifierText = "";

            questionsData.forEach((q, index) => {
                const questionWrapper = document.createElement('div');
                questionWrapper.classList.add('question-wrapper');
                questionWrapper.dataset.questionId = q.id || `q-${index}`;

                // Determine section identifier based on question type
                if (!addedSections[q.type]) {
                    addedSections[q.type] = true;
                    
                    // Generate section header based on question type
                    switch (q.type) {
                        case "multiple_choice":
                            const mcCount = questionsData.filter(q => q.type === "multiple_choice").length;
                            sectionIdentifierText = `Multiple Choice<br><em>Shade the correct option from the given choices.</em>`;
                            break;
                        case "special":
                            sectionIdentifierText = `Special Paper 2<br><em>Identify the pattern carefully and tell the difference or sequence.</em>`;
                            break;
                        // Add all other question types here...
                        default:
                            sectionIdentifierText = "Section";
                    }

                    // Create section identifier
                    const sectionIdentifier = document.createElement('div');
                    sectionIdentifier.classList.add('section-identifier');
                    sectionIdentifier.innerHTML = sectionIdentifierText;
                    questionWrapper.appendChild(sectionIdentifier);
                }

                // Create question text (skip for certain types)
                if (q.type !== "true_false" && q.type !== "fill_in_the_blank" && q.type !== "sounds") {
                    const questionText = document.createElement('div');
                    questionText.innerHTML = `${index + 1}. ${q.question}`;
                    questionWrapper.appendChild(questionText);
                }

                // Handle each question type
                switch (q.type) {
                    case "multiple_choice":
                        handleMultipleChoice(q, index, questionWrapper);
                        break;
                    case "special":
                        handleSpecial(q, index, questionWrapper);
                        break;
                    // Add all other question type handlers here...
                    default:
                        console.warn(`Unhandled question type: ${q.type}`);
                }

                testContainer.appendChild(questionWrapper);
            });
        }

        // Grading functions (similar to previous implementation)
        function gradeTest() {
            const resultsContainer = document.getElementById('results-display');
            resultsContainer.innerHTML = '';
            
            let correctCount = 0;
            let totalQuestions = 0;
            
            const questions = document.querySelectorAll('[data-question-id]');
            
            questions.forEach((question, index) => {
                const questionId = question.dataset.questionId;
                const userAnswer = getUserAnswer(question);
                const correctAnswer = getCorrectAnswer(questionId);
                
                if (correctAnswer) {
                    totalQuestions++;
                    
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    
                    const isCorrect = checkAnswerCorrectness(userAnswer, correctAnswer);
                    
                    if (isCorrect) {
                        resultItem.classList.add('correct');
                        correctCount++;
                        resultItem.innerHTML = `
                            <p><strong>Question ${index + 1}: Correct!</strong></p>
                            <p>Your answer: ${formatAnswer(userAnswer)}</p>
                        `;
                    } else {
                        resultItem.classList.add('incorrect');
                        resultItem.innerHTML = `
                            <p><strong>Question ${index + 1}: Incorrect</strong></p>
                            <p>Your answer: ${formatAnswer(userAnswer) || 'No answer provided'}</p>
                            <p>Correct answer: ${formatAnswer(correctAnswer)}</p>
                        `;
                    }
                    
                    resultsContainer.appendChild(resultItem);
                }
            });
            
            if (totalQuestions > 0) {
                const scorePercentage = Math.round((correctCount / totalQuestions) * 100);
                const scoreDisplay = document.createElement('div');
                scoreDisplay.className = 'score-display';
                scoreDisplay.innerHTML = `Your Score: ${correctCount} out of ${totalQuestions} (${scorePercentage}%)`;
                resultsContainer.prepend(scoreDisplay);
            } else {
                resultsContainer.innerHTML = '<p>No questions with answer data found.</p>';
            }
        }
        
        // Helper functions (same as before)
        function getUserAnswer(questionElement) {
            const selectedRadio = questionElement.querySelector('input[type="radio"]:checked');
            if (selectedRadio) return selectedRadio.value;
            
            const checkedBoxes = Array.from(questionElement.querySelectorAll('input[type="checkbox"]:checked'));
            if (checkedBoxes.length > 0) return checkedBoxes.map(box => box.value);
            
            const textInput = questionElement.querySelector('input[type="text"], textarea');
            if (textInput) return textInput.value;
            
            const select = questionElement.querySelector('select');
            if (select) return select.options[select.selectedIndex]?.value;
            
            const editable = questionElement.querySelector('[contenteditable="true"]');
            if (editable) return editable.textContent;
            
            return null;
        }
        
        function getCorrectAnswer(questionId) {
            return localStorage.getItem(`answer-${questionId}`);
        }
        
        function checkAnswerCorrectness(userAnswer, correctAnswer) {
            if (Array.isArray(userAnswer)) {
                const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                if (userAnswer.length !== correctAnswers.length) return false;
                return correctAnswers.every(ca => userAnswer.includes(ca));
            }
            return userAnswer == correctAnswer;
        }
        
        function formatAnswer(answer) {
            if (Array.isArray(answer)) return answer.join(', ');
            return answer;
        }
        
        // Add event listener to submit button
        document.getElementById('submit-btn').addEventListener('click', gradeTest);
    </script>
</body>
</html>




<!--
<!
        /* Additional styles for the submission and results */
        #submission-container {
            margin: 20px auto;
            padding: 20px;
            max-width: 800px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        #submit-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        #submit-btn:hover {
            background-color: #45a049;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: white;
        }
        
        .correct {
            border-left: 4px solid #4CAF50;
        }
        
        .incorrect {
            border-left: 4px solid #f44336;
        }
        
        .score-display {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            font-weight: bold;
        }
        
        /* Hide unnecessary elements in standalone version */
        #savePDF, #refreshBtn, #printContent, #saveAsStandalone, 
        #show-answer-key-btn, .watermark {
            display: none !important;
        }
    </style>
</head>
<body>
    <div style="display: flex; justify-content: space-between; margin: 0 5px;">
        <a id="home-link"><img src="../images/Flying_Wings_Academy.png" id="logo" alt="home_logo" title="Flying_Wings_Home" width="306" height="250"></a>
        <h2 id="Heading">Flying Wings Academy</h2>
    </div>
    <p id="motto">The Way to Success</p>

    <div class="table-container">
        <table>
            <tr>
                <th colspan="5">Performance Report</th>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td style="text-align:right;font-family: 'Dancing Script', cursive;">%</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <th colspan="5" style="height:15px;background-color:transparent;border-radius:0 0 10px 10px;border-top:1px solid rgba(0,0,0,0.4);"></th>
            </tr>
        </table>
    </div>

    <div style="display: flex; justify-content: space-between; margin: 0 5px;">
        <p id="class-name">Class</p>
        <p id="subject">Subject</p>
        <p id="term">Term</p>
        <p id="part">Part</p>
    </div>

    <div style="display: flex; justify-content: space-between; margin: 0 5px;">
        <p class="pupil">Your Full Names: ___________________________ _________________ ___________________________</p>
    </div>

    <img id="classImage" src="" alt="Class Image" />

    <svg id="barcode"></svg>

    <div id="test-container">
        <div class="content-section">
            <!-- Questions will be loaded here dynamically --
        </div>
    </div>
    <div id="teacher-name"></div>

    <!-- Submission container --
    <div id="submission-container">
        <button id="submit-btn">Submit Answers</button>
        <div id="results-display"></div>
    </div>

    <footer class="page-number"></footer>

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <script>
        // Load test data from URL parameters
        document.addEventListener('DOMContentLoaded', function() {
            // Get test data from URL
            const urlParams = new URLSearchParams(window.location.search);
            const testData = urlParams.get('data');
            
            if (testData) {
                try {
                    const data = JSON.parse(decodeURIComponent(testData));
                    loadTestData(data);
                } catch (e) {
                    console.error('Error parsing test data:', e);
                    alert('Error loading test data');
                }
            }
            
            // Generate barcode with current URL
            JsBarcode("#barcode", window.location.href, {
                format: "CODE128",
                displayValue: true
            });
            
            // Remove home link href in standalone version
            document.getElementById('home-link').removeAttribute('href');
        });

        function loadTestData(data) {
            // Load class info
            if (data.className) document.getElementById('class-name').textContent = data.className;
            if (data.subject) document.getElementById('subject').textContent = data.subject;
            if (data.term) document.getElementById('term').textContent = data.term;
            if (data.part) document.getElementById('part').textContent = data.part;
            if (data.classImage) document.getElementById('classImage').src = data.classImage;
            if (data.teacherName) document.getElementById('teacher-name').textContent = data.teacherName;
            
            // Load questions (you'll need to implement this based on your question types)
            const contentSection = document.querySelector('.content-section');
            if (data.questions) {
                // This is a simplified example - you'll need to adapt it to your actual question rendering
                data.questions.forEach((q, i) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-container';
                    questionDiv.dataset.questionId = q.id;
                    questionDiv.innerHTML = `
                        <h3>Question ${i+1}</h3>
                        <p>${q.text}</p>
                        ${renderQuestionInput(q)}
                    `;
                    contentSection.appendChild(questionDiv);
                });
            }
            
            // Store correct answers in localStorage
            if (data.answers) {
                localStorage.clear();
                Object.keys(data.answers).forEach(key => {
                    localStorage.setItem(`answer-${key}`, data.answers[key]);
                });
            }
        }

        function renderQuestionInput(question) {
            // Implement based on your question types
            // This is just a simple example
            switch(question.type) {
                case 'multiple-choice':
                    return `
                        <div>
                            ${question.options.map((opt, i) => `
                                <label>
                                    <input type="radio" name="q-${question.id}" value="${opt}">
                                    ${opt}
                                </label><br>
                            `).join('')}
                        </div>
                    `;
                case 'text':
                    return `<input type="text" name="q-${question.id}">`;
                default:
                    return `<p>Unsupported question type</p>`;
            }
        }

        // Function to grade the test
        function gradeTest() {
            const resultsContainer = document.getElementById('results-display');
            resultsContainer.innerHTML = '';
            
            let correctCount = 0;
            let totalQuestions = 0;
            
            // Get all question elements
            const questions = document.querySelectorAll('[data-question-id]');
            
            questions.forEach((question, index) => {
                const questionId = question.dataset.questionId;
                const userAnswer = getUserAnswer(question);
                const correctAnswer = getCorrectAnswer(questionId);
                
                if (correctAnswer) {
                    totalQuestions++;
                    
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    
                    const isCorrect = checkAnswerCorrectness(userAnswer, correctAnswer);
                    
                    if (isCorrect) {
                        resultItem.classList.add('correct');
                        correctCount++;
                        resultItem.innerHTML = `
                            <p><strong>Question ${index + 1}: Correct!</strong></p>
                            <p>Your answer: ${formatAnswer(userAnswer)}</p>
                        `;
                    } else {
                        resultItem.classList.add('incorrect');
                        resultItem.innerHTML = `
                            <p><strong>Question ${index + 1}: Incorrect</strong></p>
                            <p>Your answer: ${formatAnswer(userAnswer) || 'No answer provided'}</p>
                            <p>Correct answer: ${formatAnswer(correctAnswer)}</p>
                        `;
                    }
                    
                    resultsContainer.appendChild(resultItem);
                }
            });
            
            if (totalQuestions > 0) {
                const scorePercentage = Math.round((correctCount / totalQuestions) * 100);
                const scoreDisplay = document.createElement('div');
                scoreDisplay.className = 'score-display';
                scoreDisplay.innerHTML = `Your Score: ${correctCount} out of ${totalQuestions} (${scorePercentage}%)`;
                resultsContainer.prepend(scoreDisplay);
            } else {
                resultsContainer.innerHTML = '<p>No questions with answer data found.</p>';
            }
        }
        
        
</body>
</html>